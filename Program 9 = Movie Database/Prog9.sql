CREATE DATABASE MOVIE;
USE MOVIE;

CREATE TABLE ACTOR ( 
ACT_ID INT, 
ACT_NAME VARCHAR (20), 
ACT_GENDER CHAR (1), 
PRIMARY KEY (ACT_ID)); 
DESC ACTOR;

CREATE TABLE DIRECTOR ( 
DIR_ID INT, 
DIR_NAME VARCHAR (20), 
DIR_PHONE REAL, 
PRIMARY KEY (DIR_ID)); 
DESC DIRECTOR;

CREATE TABLE MOVIES ( 
MOV_ID INT, 
MOV_TITLE VARCHAR (25), 
MOV_YEAR INT, 
MOV_LANG VARCHAR (12), 
DIR_ID INT, 
PRIMARY KEY (MOV_ID), 
FOREIGN KEY (DIR_ID) REFERENCES DIRECTOR (DIR_ID));
DESC MOVIES;

CREATE TABLE MOVIE_CAST ( 
ACT_ID INT, 
MOV_ID INT, 
ROLE VARCHAR (10), 
PRIMARY KEY (ACT_ID, MOV_ID), 
FOREIGN KEY (ACT_ID) REFERENCES ACTOR (ACT_ID), 
FOREIGN KEY (MOV_ID) REFERENCES MOVIES (MOV_ID)); 
DESC MOVIE_CAST;

CREATE TABLE RATING ( 
MOV_ID INT, 
REV_STARS VARCHAR (25), 
PRIMARY KEY (MOV_ID), 
FOREIGN KEY (MOV_ID) REFERENCES MOVIES (MOV_ID));
DESC RATING;

INSERT INTO ACTOR VALUES (301,'ANTHONY PERKINS','M'); 
INSERT INTO ACTOR VALUES (302,'SAOIRSE RONAN','F'); 
INSERT INTO ACTOR VALUES (303,'UMA THURMAN','F'); 
INSERT INTO ACTOR VALUES (304,'LEONARDO DICAPRIO','M'); 
INSERT INTO ACTOR VALUES (305,'VIDYA BALAN','F'); 
INSERT INTO ACTOR VALUES (306,'NAWAZUDDIN SIDDIQUI','M'); 
COMMIT;
SELECT * FROM ACTOR;

INSERT INTO DIRECTOR VALUES (60,'GRETA GERWIG', 8751611001); 
INSERT INTO DIRECTOR VALUES (61,'HITCHCOCK', 7766138911); 
INSERT INTO DIRECTOR VALUES (62,'STEVEN SPIELBERG', 9986776531); 
INSERT INTO DIRECTOR VALUES (63,'QUENTIN TARANTINO', 8989776530); 
INSERT INTO DIRECTOR VALUES (64,'SUJOY GHOSH', 9783335281); 
COMMIT;
SELECT * FROM DIRECTOR;

INSERT INTO MOVIES VALUES (1001,'LITTLE WOMEN',2019,'ENGLISH',60); 
INSERT INTO MOVIES VALUES (1002,'KAHAANI',2012,'HINDI',64); 
INSERT INTO MOVIES VALUES (1003,'KILL BILL : VOL.1',2003,'ENGLISH',63); 
INSERT INTO MOVIES VALUES (1004,'PSYCHO',1960,'ENGLISH',61);
INSERT INTO MOVIES VALUES (1005,'CATCH ME IF YOU CAN',2002,'ENGLISH',62); 
INSERT INTO MOVIES VALUES (1006,'ONCE UPON A TIME IN HOLLYWOOD',2019,'ENGLISH',63);
INSERT INTO MOVIES VALUES (1007,'KAHAANI 2: DURGA RANI SINGH',2016,'HINDI',64);
COMMIT;
SELECT * FROM MOVIES;

INSERT INTO MOVIE_CAST VALUES (301,1004,'HERO'); 
INSERT INTO MOVIE_CAST VALUES (302,1001,'HEROINE'); 
INSERT INTO MOVIE_CAST VALUES (303,1003,'HEROINE'); 
INSERT INTO MOVIE_CAST VALUES (304,1005,'HERO'); 
INSERT INTO MOVIE_CAST VALUES (305,1002,'HEROINE');
INSERT INTO MOVIE_CAST VALUES (306,1002,'HERO');  
INSERT INTO MOVIE_CAST VALUES (304,1006,'HERO');
INSERT INTO MOVIE_CAST VALUES (305,1007,'HEROINE');
COMMIT;
SELECT * FROM MOVIE_CAST;

INSERT INTO RATING VALUES (1001, 4); 
INSERT INTO RATING VALUES (1002, 4);
INSERT INTO RATING VALUES (1003, 3); 
INSERT INTO RATING VALUES (1004, 5);
INSERT INTO RATING VALUES (1005, 4);
INSERT INTO RATING VALUES (1006, 4);
INSERT INTO RATING VALUES (1007, 3);
COMMIT;
SELECT * FROM RATING;

SELECT MOV_TITLE 
FROM MOVIES 
WHERE DIR_ID IN (SELECT DIR_ID 
FROM DIRECTOR 
WHERE DIR_NAME = 'HITCHCOCK');

SELECT MOV_TITLE 
FROM MOVIES M, MOVIE_CAST MV 
WHERE M.MOV_ID=MV.MOV_ID AND ACT_ID IN (SELECT ACT_ID 
FROM MOVIE_CAST GROUP BY ACT_ID 
HAVING COUNT(ACT_ID)>=1) 
GROUP BY MOV_TITLE 
HAVING COUNT(*)>1;

SELECT ACT_NAME, MOV_TITLE, MOV_YEAR
FROM ACTOR A 
JOIN MOVIE_CAST C 
ON A.ACT_ID=C.ACT_ID 
JOIN MOVIES M 
ON C.MOV_ID=M.MOV_ID 
WHERE M.MOV_YEAR NOT BETWEEN 2000 AND 2015;

SELECT MOV_TITLE, MAX(REV_STARS) 
FROM MOVIES 
INNER JOIN RATING USING (MOV_ID) 
GROUP BY MOV_TITLE 
HAVING MAX(REV_STARS)>0 
ORDER BY MOV_TITLE;

SET SQL_SAFE_UPDATES = 0;
UPDATE RATING 
SET REV_STARS=5 
WHERE MOV_ID IN (SELECT MOV_ID FROM MOVIES 
WHERE DIR_ID IN (SELECT DIR_ID FROM DIRECTOR 
WHERE DIR_NAME = 'STEVEN SPIELBERG'));
SELECT * FROM RATING;
SET SQL_SAFE_UPDATES = 1;
