CREATE DATABASE ORDPROCESS;
USE ORDPROCESS;

CREATE TABLE SALESMAN(SALESMAN_ID INT, 
NAME VARCHAR (20), 
CITY VARCHAR (20), 
COMMISSION VARCHAR (20), 
PRIMARY KEY (SALESMAN_ID));
DESC SALESMAN;

CREATE TABLE CUSTOMER 
(CUSTOMER_ID INT, 
CUST_NAME VARCHAR (20), 
CITY VARCHAR (20), 
GRADE INT, 
SALESMAN_ID INT,
PRIMARY KEY (CUSTOMER_ID), 
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID) ON DELETE SET NULL);
DESC CUSTOMER;

CREATE TABLE ORDERS 
(ORD_NO INT, 
PURCHASE_AMT REAL, 
ORD_DATE DATE, 
CUSTOMER_ID INT,
SALESMAN_ID INT,
PRIMARY KEY (ORD_NO), 
FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE, 
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE);
DESC ORDERS;

INSERT INTO SALESMAN VALUES (1000,'JOHN','BANGALORE','25 %'); 
INSERT INTO SALESMAN VALUES (2000,'RAVI','BANGALORE','20 %'); 
INSERT INTO SALESMAN VALUES (3000,'KUMAR','MYSORE','15 %'); 
INSERT INTO SALESMAN VALUES (4000,'SMITH','DELHI','30 %'); 
INSERT INTO SALESMAN VALUES (5000,'HARSHA','HYDERABAD','15 %');
COMMIT;
SELECT * FROM SALESMAN; 

INSERT INTO CUSTOMER VALUES (10,'PREETHI','BANGALORE', 100, 1000); 
INSERT INTO CUSTOMER VALUES (11,'VIVEK','MANGALORE', 300, 1000); 
INSERT INTO CUSTOMER VALUES (12,'BHASKAR','CHENNAI', 400, 2000); 
INSERT INTO CUSTOMER VALUES (13,'CHETHAN','BANGALORE', 200, 2000); 
INSERT INTO CUSTOMER VALUES (14,'MAMATHA','BANGALORE', 400, 3000); 
COMMIT;
SELECT * FROM CUSTOMER;

INSERT INTO ORDERS VALUES (50, 5000,'2017-05-04',10,1000); 
INSERT INTO ORDERS VALUES (51, 450,'2017-01-20',10,2000);
INSERT INTO ORDERS VALUES (52, 1000,'2017-02-24',13,2000); 
INSERT INTO ORDERS VALUES (53, 3500,'2017-04-13',14,3000); 
INSERT INTO ORDERS VALUES (54, 550,'2017-03-09',12,2000);
COMMIT;
SELECT * FROM ORDERS;

SELECT GRADE, COUNT(DISTINCT CUSTOMER_ID) 
FROM CUSTOMER 
GROUP BY GRADE 
HAVING GRADE > (SELECT AVG(GRADE) FROM CUSTOMER WHERE CITY='BANGALORE');

SELECT SALESMAN_ID, NAME 
FROM SALESMAN S1 
WHERE 1 < (SELECT COUNT(*) 
FROM CUSTOMER 
WHERE SALESMAN_ID=S1.SALESMAN_ID);

SELECT S.SALESMAN_ID, NAME, CUST_NAME, COMMISSION 
FROM SALESMAN S, CUSTOMER C 
WHERE S.CITY = C.CITY 
UNION 
SELECT SALESMAN_ID, NAME, 'NO MATCH', COMMISSION 
FROM SALESMAN 
WHERE NOT CITY = ANY 
(SELECT CITY 
FROM CUSTOMER) 
ORDER BY 2 DESC;

CREATE VIEW ELITESALESMAN AS 
SELECT O.ORD_DATE, S.SALESMAN_ID, S.NAME 
FROM SALESMAN S, ORDERS O
WHERE S.SALESMAN_ID = O.SALESMAN_ID 
AND O.PURCHASE_AMT=(SELECT MAX(PURCHASE_AMT) 
FROM ORDERS O1
WHERE O1.ORD_DATE = O.ORD_DATE);
SELECT * FROM ELITESALESMAN;

DELETE FROM SALESMAN 
WHERE SALESMAN_ID=1000;
SELECT * FROM SALESMAN;
SELECT * FROM ORDERS;